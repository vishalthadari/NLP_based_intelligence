YUI.add("hermes-template-photo-note-read-mode",function(a,e){var t=a.Template.Handlebars.revive({1:function(a,e,t,n,l){var r,s=null!=e?e:{},o=t.helperMissing,u=a.escapeExpression;return'\t\t\t<span class="author">'+u("function"==typeof(r=null!=(r=t.authorName||(null!=e?e.authorName:e))?r:o)?r.call(s,{name:"authorName",hash:{},data:l}):r)+" ("+u((t.intlMessage||e&&e.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"common.DELETED_USER"},data:l}))+")</span><br>\n"},3:function(a,e,t,n,l){var r,s,o=null!=e?e:{},u=t.helperMissing,i=a.escapeExpression;return'\t\t\t<a href="'+i("function"==typeof(s=null!=(s=t.authorURL||(null!=e?e.authorURL:e))?s:u)?s.call(o,{name:"authorURL",hash:{},data:l}):s)+'" class="author">'+i("function"==typeof(s=null!=(s=t.authorName||(null!=e?e.authorName:e))?s:u)?s.call(o,{name:"authorName",hash:{},data:l}):s)+"</a>"+(null!=(r=t.if.call(o,null!=e?e.authorIsPro:e,{name:"if",hash:{},fn:a.program(4,l,0),inverse:a.noop,data:l}))?r:"")+"<br>\n"},4:function(a,e,t,n,l){var r;return null!=(r=a.invokePartial(n["pro-badge"],e,{name:"pro-badge",data:l,helpers:t,partials:n,decorators:a.decorators}))?r:""},compiler:[7,">= 4.0.0"],main:function(a,e,t,n,l){var r,s,o=null!=e?e:{},u=t.helperMissing,i=a.escapeExpression;return'<div class="note-text" style="z-index:'+i("function"==typeof(s=null!=(s=t.z||(null!=e?e.z:e))?s:u)?s.call(o,{name:"z",hash:{},data:l}):s)+';">\n\t<div class="text-alignment-fix hyphenate" style="left:'+i("function"==typeof(s=null!=(s=t.x||(null!=e?e.x:e))?s:u)?s.call(o,{name:"x",hash:{},data:l}):s)+"px;top:"+i("function"==typeof(s=null!=(s=t.y||(null!=e?e.y:e))?s:u)?s.call(o,{name:"y",hash:{},data:l}):s)+'px">\n'+(null!=(r=t.if.call(o,null!=e?e.authorIsDeleted:e,{name:"if",hash:{},fn:a.program(1,l,0),inverse:a.program(3,l,0),data:l}))?r:"")+"\t\t"+i((t.renderTrustedMarkup||e&&e.renderTrustedMarkup||u).call(o,null!=e?e.text:e,{name:"renderTrustedMarkup",hash:{},data:l}))+"\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),n={};a.Array.each(["pro-badge"],function(e){var t=a.Template.get("hermes/"+e);t&&(n[e]=t)}),a.Template.register("hermes/photo-note-read-mode",function(e,l){return l=l||{},l.partials=l.partials?a.merge(n,l.partials):n,t(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge"]});YUI.add("hermes-template-photo-note-write-mode",function(e,t){var a=e.Template.Handlebars.revive({1:function(e,t,a,n,l){return'<button class="delete-note danger tiny">'+e.escapeExpression((a.intlMessage||t&&t.intlMessage||a.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.DELETE"},data:l}))+"</button>"},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,l){var s,i,o=null!=t?t:{},r=a.helperMissing,c="function",m=e.escapeExpression;return'<div class="note-text adding" data-for-note-yuid="'+m(typeof(i=null!=(i=a.noteYUID||(null!=t?t.noteYUID:t))?i:r)===c?i.call(o,{name:"noteYUID",hash:{},data:l}):i)+'" style="z-index:'+m(typeof(i=null!=(i=a.z||(null!=t?t.z:t))?i:r)===c?i.call(o,{name:"z",hash:{},data:l}):i)+';">\n\t<div class="text-alignment-fix hyphenate" style="left:'+m(typeof(i=null!=(i=a.x||(null!=t?t.x:t))?i:r)===c?i.call(o,{name:"x",hash:{},data:l}):i)+"px;top:"+m(typeof(i=null!=(i=a.y||(null!=t?t.y:t))?i:r)===c?i.call(o,{name:"y",hash:{},data:l}):i)+'px">\n\t\t<textarea class="note-text-textarea" placeholder="'+m((a.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_A_NOTE"},data:l}))+'">'+m(typeof(i=null!=(i=a.text||(null!=t?t.text:t))?i:r)===c?i.call(o,{name:"text",hash:{},data:l}):i)+'</textarea>\n\t\t<div class="note-text-buttons">\n\t\t\t<button class="save-note tiny">'+m((a.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"common.SAVE"},data:l}))+'</button>\n\t\t\t<button class="cancel-note alt tiny">'+m((a.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:l}))+"</button>"+(null!=(s=a.if.call(o,null!=t?t.canDelete:t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?s:"")+"\n\t\t</div>\n\t</div>\n</div>"},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/photo-note-write-mode",function(t,l){return l=l||{},l.partials=l.partials?e.merge(n,l.partials):n,a(t,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-note-drag-handles",function(a,e){var r=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,e,r,n,t){return'<span class="note-drag-handle note-drag-handle-tl" data-drag-resize-direction="tl"></span><span class="note-drag-handle note-drag-handle-tr" data-drag-resize-direction="tr"></span><span class="note-drag-handle note-drag-handle-br" data-drag-resize-direction="br"></span><span class="note-drag-handle note-drag-handle-bl" data-drag-resize-direction="bl"></span>'},useData:!0}),n={};a.Array.each([],function(e){var r=a.Template.get("hermes/"+e);r&&(n[e]=r)}),a.Template.register("hermes/photo-note-drag-handles",function(e,t){return t=t||{},t.partials=t.partials?a.merge(n,t.partials):n,r(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-notes-scrappy-view",function(e,t){function o(t){this.yuid=e.guid(),this.id=t.id,this.photoId=t.photoId,this.x=t.x,this.y=t.y,this.z=0,this.w=t.w,this.h=t.h,this.text=t.text,this.author=t.author,this.authorName=t.authorName,this.authorRealName=t.authorRealName,this.authorIsPro=t.authorIsPro,this.authorIsDeleted=t.authorIsDeleted,this.canEdit=t.canEdit,this.canDelete=t.canDelete,this.isStoredOnServer=t.isStoredOnServer}o.prototype.getScaled=function(e){return{x:this.x*e,y:this.y*e,w:this.w*e,h:this.h*e}};var i=1,n={idle:{begin:"beginIdle",end:"endIdle",events:{mousedown:"handleIdleMouseDown",mouseup:"handleIdleMouseUp",mouseenter:{handler:"handleIdleMouseEnter",delegate:".note"},mouseleave:{handler:"handleIdleMouseLeave",delegate:".note"}}},editing:{begin:"beginEditing",events:{mousedown:"handleEditingMouseDown",mouseup:"handleEditingMouseUp",keydown:"handleEditingKeyDown"}},dragging:{begin:"beginDragging",end:"endDragging",events:{mousemove:"handleDraggingMouseMove",mouseup:"handleDraggingMouseUp"}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.stateEventHandles=[],this},loadState:function(){var t,o=this;return t={photo:this.appContext.getModel("photo-models",this._params.photoId),photoNotes:this.appContext.getModel("photo-notes-models",this._params.photoId),noteModel:this.appContext.getModelRegistry("note-models")},this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid&&(t.viewer=this.appContext.getModel("person-models",this.appContext.getViewer().nsid)),new e.FlickrPromise(t).then(function(e){o.set("photoModel",e.photo),o.set("photoNotesModel",e.photoNotes),o.set("noteModel",e.noteModel),e.viewer&&o.set("viewer",e.viewer)})},buildContainer:function(){return this},activate:function(){var t,i,n,s,a=this.appContext.flipper.isFlipped("enable-scrappy-notes-deleting"),h=this.appContext.flipper.isFlipped("enable-scrappy-notes-editing"),r=this.get("photoModel"),d=r.getValue("owner").getValue("id"),l=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid,g=this.get("photoNotesModel").getValue("notes").toJSON();if(r.getValue("isVideo"))return this.deactivate(),this;for(this.box=this.get("container"),this.notes=[],this.canAddNotes=r.getValue("canAddMeta"),this.canAddNotes&&this.box.setStyle("pointerEvents","auto"),this.registerEventHandler(this.box.on("mouseenter",this.revealNotes.bind(this))),this.registerEventHandler(this.box.on("mouseleave",this.hideNotes.bind(this))),this.registerEventHandler(e.on("photo:entering-vr",this.deactivate.bind(this))),i=0;i<g.length;i++)t=g[i],n=h&&(l===d||l===t.author),s=a&&(l===d||l===t.author),this.notes.push(new o({id:t.id,photoId:r.getValue("id"),x:t.left,y:t.top,w:t.width,h:t.height,text:t.text,author:t.author,authorName:t.authorName,authorRealName:t.authorRealName,authorIsPro:t.authorIsPro,authorIsDeleted:t.authorIsDeleted,canEdit:n,canDelete:s,isStoredOnServer:!0}));return this.restackNotes(),this.syncWithPhoto(),this.renderNotes(),this.revealNotes(),this.pageLoadNotesFlashTimer=setTimeout(this.hideNotes.bind(this),1e3),this.enterState("idle"),this},onParentViewEvent:function(e,t){t&&"photoWellResized"===t[0]&&this.isActivated&&this.box&&(this.syncWithPhoto(),this.renderNotes())},enterState:function(e,t){var o;if(t=t||{},n[e]){for(;this.stateEventHandles.length;)this.stateEventHandles.pop().detach();this.currentState&&n[this.currentState].end&&this[n[this.currentState].end]&&this[n[this.currentState].end].call(this,t);for(var i in n[e].events)"string"==typeof(o=n[e].events[i])?this.stateEventHandles.push(this.box.on(i,this[o].bind(this))):"object"==typeof o&&(o.delegate?this.stateEventHandles.push(this.box.delegate(i,this[o.handler].bind(this),o.delegate)):this.stateEventHandles.push(this.box.on(i,this[o.handler].bind(this))));n[e].begin&&this[n[e].begin]&&this[n[e].begin].call(this,t),this.currentState=e}},revealNotes:function(e){this.box.addClass("box-hovered"),clearTimeout(this.pageLoadNotesFlashTimer)},hideNotes:function(){this.box.removeClass("box-hovered"),this.hideHovered()},beginIdle:function(e){var t=e.element;this.box.removeClass("box-note-clicked"),delete this.draggingMemo,this.box.all(".note-text").remove(!0),t&&t.getDOMNode()&&t.removeClass("note-clicked"),e.rerender&&(this.restackNotes(),this.renderNotes())},endIdle:function(e){this.tempMouseMoveListener&&(this.tempMouseMoveListener.detach(),delete this.tempMouseMoveListener)},handleIdleMouseDown:function(t){var i,n,s,a,h=!1;1!==t.button||t.ctrlKey||t.metaKey||t.target.hasClass("note-text")||(t.target.hasClass("note")&&(i=this.getNoteByID(t.target.getAttribute("data-note-yuid"))),i&&(i.canEdit||i.canDelete)?this.enterState("editing",{note:i,element:t.target}):(s={x:t.clientX,y:t.clientY},a=this.box.getXY(),this.canAddNotes&&(t.preventDefault(),this.tempMouseMoveListener=this.box.on("mousemove",function(t){var i,r,d,l,g;if(i=Math.sqrt(Math.pow(t.clientX-s.x,2)+Math.pow(t.clientY-s.y,2)),r="",!(i<20)){switch(h||(h=!0,this.box.addClass("doing-initial-drag")),r+=s.y-t.clientY>=0?"t":"b",r+=s.x-t.clientX>=0?"l":"r"){case"tl":l=0,g=0;break;case"tr":l=8,g=0;break;case"bl":l=0,g=8;break;case"br":l=8,g=8}d=this.get("viewer"),n=new o({id:e.guid(),photoId:this.get("photoModel").getValue("id"),x:(Math.min(s.x,t.clientX)-a[0]+window.pageXOffset)/this.ratio,y:(Math.min(s.y,t.clientY)-a[1]+window.pageYOffset)/this.ratio,w:Math.abs(s.x-t.clientX)/this.ratio-l,h:Math.abs(s.y-t.clientY)/this.ratio-g,text:"",author:d.getValue("nsid"),authorName:d.getValue("username"),authorRealName:d.getValue("displayname"),authorIsPro:d.getValue("isPro"),authorIsDeleted:!1,canEdit:!0,canDelete:!0,isStoredOnServer:!1}),this.notes.push(n),this.createNewNote(n),this.storeNoteBackup(n),n.node.append(this.templates("photo-note-drag-handles")()),this.box.addClass("box-note-clicked"),n.node.addClass("note-clicked"),n.node.addClass("note-can-edit"),this.enterState("dragging",{note:n,element:n.node,dragMetadata:{type:"resize",startX:Math.min(s.x,t.clientX)+window.pageXOffset,startY:Math.min(s.y,t.clientY)+window.pageYOffset,dragHandle:n.node.one(".note-drag-handle-"+r),direction:r}})}}.bind(this)))))},handleIdleMouseUp:function(t){this.tempMouseMoveListener&&(this.tempMouseMoveListener.detach(),delete this.tempMouseMoveListener),t.target===this.box&&e.fire("photo:zoom",{x:t.pageX,y:t.pageY})},handleIdleMouseEnter:function(e){var t,o=e.target.ancestor(".note",!0),n=this.getNoteByID(o.getAttribute("data-note-yuid")),s=n.getScaled(this.ratio);this.delayedNoteMouseLeaveHandler&&(this.hideHovered(),clearTimeout(this.delayedNoteMouseLeaveHandler),delete this.delayedNoteMouseLeaveHandler),o.addClass("note-hovered"),o.insert(this.templates("photo-note-read-mode")({x:s.x,y:s.y+s.h+2,z:i,text:n.text.replace(/\n/g,"<br>"),authorName:n.authorRealName||n.authorName,authorURL:"/photos/"+n.author+"/",authorIsPro:n.authorIsPro,authorIsDeleted:n.authorIsDeleted}),"after"),(t=this.box.one(".note-text")).on("mouseenter",function(e){this.delayedNoteMouseLeaveHandler&&(clearTimeout(this.delayedNoteMouseLeaveHandler),delete this.delayedNoteMouseLeaveHandler)}.bind(this)),t.on("mouseleave",this.handleIdleMouseLeave.bind(this))},handleIdleMouseLeave:function(e){this.delayedNoteMouseLeaveHandler=setTimeout(this.hideHovered.bind(this),100)},beginEditing:function(e){var t=e.note,o=e.element,n=t.getScaled(this.ratio);this.storeNoteBackup(t),this.hideHovered(),this.box.hasClass("box-note-clicked")||this.box.addClass("box-note-clicked"),o.hasClass("note-clicked")||o.addClass("note-clicked"),0===o.siblings(".note-text.adding").size()&&o.insert(this.templates("photo-note-write-mode")({noteYUID:t.yuid,x:n.x,y:n.y+n.h+2,z:i,text:t.text.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),canDelete:t.isStoredOnServer}),"after"),o.one(".note-drag-handle")||o.append(this.templates("photo-note-drag-handles")()),setTimeout(function(){this.box.one(".note-text[data-for-note-yuid="+t.yuid+"] textarea").focus()}.bind(this),10)},handleEditingMouseDown:function(e){var t,o,i;1!==e.button||e.ctrlKey||e.metaKey||(o=e.target.ancestor(".note",!0))&&(t=this.getNoteByID(o.getAttribute("data-note-yuid")))&&t.canEdit&&(e.target.hasClass("note-drag-handle")?i={type:"resize",startX:e.clientX+window.pageXOffset,startY:e.clientY+window.pageYOffset,dragHandle:e.target,direction:e.target.getAttribute("data-drag-resize-direction")}:e.target.hasClass("note-clicked")&&(i={type:"move",startX:e.clientX+window.pageXOffset,startY:e.clientY+window.pageYOffset,dragHandle:e.target}),i&&this.enterState("dragging",{note:t,element:o,dragMetadata:i}))},handleEditingMouseUp:function(e){e.target.test("button")&&this.performButtonAction(e)},handleEditingKeyDown:function(e){var t=this.box.one(".note-clicked"),o=this.getNoteByID(t.getAttribute("data-note-yuid"));switch(e.keyCode){case 8:(e.ctrlKey||e.metaKey)&&window.confirm(this.intlMessage({intlName:"photo-page-scrappy.CONFIRM_NOTE_DELETION"}))&&(this.deleteNote(o,t),e.preventDefault());break;case 13:(e.ctrlKey||e.metaKey)&&(this.saveNoteEdits(o,t),e.preventDefault()),e.target.test("button")&&this.performButtonAction(e);break;case 27:this.cancelNoteEdits(o,t);break;case 32:e.target.test("button")&&this.performButtonAction(e)}},performButtonAction:function(e){var t=this.box.one(".note-clicked"),o=this.getNoteByID(t.getAttribute("data-note-yuid"));e.target.hasClass("save-note")?this.saveNoteEdits(o,t):e.target.hasClass("cancel-note")?this.cancelNoteEdits(o,t):e.target.hasClass("delete-note")&&window.confirm(this.intlMessage({intlName:"photo-page-scrappy.CONFIRM_NOTE_DELETION"}))&&this.deleteNote(o,t)},saveNoteEdits:function(e,t){var o=this.get("noteModel"),i=this;e.text=i.box.one(".note-text[data-for-note-yuid="+e.yuid+"] textarea").get("value").trim(),e.text&&(e.isStoredOnServer?(o.setValues(e.id,{left:e.x,top:e.y,width:e.w,height:e.h,text:e.text}),o.remoteUpdate(e.id).then(function(o){o&&(e.text=o.getValue("text")),i.deleteNoteBackup(),i.enterState("idle",{note:e,element:t,rerender:!0})},function(e){})):o.remoteCreate({photoId:e.photoId,left:e.x,top:e.y,width:e.w,height:e.h,text:e.text,author:e.author,authorName:e.authorName,authorRealName:e.authorRealName,authorIsPro:e.authorIsPro,authorIsDeleted:!1}).then(function(o){e.id=o.getValue("id"),e.text=o.getValue("text"),e.isStoredOnServer=!0,i.deleteNoteBackup(),i.enterState("idle",{note:e,element:t,rerender:!0})},function(e){}))},cancelNoteEdits:function(e,t){var o;e.isStoredOnServer?(o=this.getNoteBackup(),e.w=o.w,e.h=o.h,e.x=o.x,e.y=o.y,this.positionNote(e)):(this.notes.pop(),this.box.one("[data-note-yuid="+e.yuid+"]").remove(!0),e=null,t=null),this.deleteNoteBackup(),this.enterState("idle",{note:e,element:t})},deleteNote:function(e,t){var o,i=this,n=!1;this.get("noteModel").remoteDelete(e.id).then(function(s){for(t.remove(!0),o=i.notes.length-1;o>=0;o--)if(i.notes[o].id===e.id){n=!0;break}n&&i.notes.splice(o,1),i.deleteNoteBackup(),i.enterState("idle",{note:e,element:t})},function(e){})},beginDragging:function(t){this.draggingMemo=e.merge(t.dragMetadata,{note:t.note,noteAtStart:e.clone(t.note),element:t.element})},endDragging:function(e){this.box.removeClass("doing-initial-drag")},handleDraggingMouseMove:function(e){var t,o,i,n,s,a,h,r,d,l,g,u,c,p=19/this.ratio;if(t=this.draggingMemo.note,o=this.draggingMemo.startX-e.clientX-window.pageXOffset,i=this.draggingMemo.startY-e.clientY-window.pageYOffset,this.boxWidth>this.boxHeight?(u=500,c=500/(this.boxWidth/this.boxHeight)):(c=500,u=500/(this.boxHeight/this.boxWidth)),"resize"===this.draggingMemo.type){switch(this.draggingMemo.direction){case"tl":n=o/this.ratio*-1,a=o/this.ratio,s=i/this.ratio*-1,h=i/this.ratio;break;case"tr":n=0,a=o/this.ratio*-1,s=i/this.ratio*-1,h=i/this.ratio;break;case"br":n=0,a=o/this.ratio*-1,s=0,h=i/this.ratio*-1;break;case"bl":n=o/this.ratio*-1,a=o/this.ratio,s=0,h=i/this.ratio*-1}r=this.draggingMemo.noteAtStart.x+n,l=this.draggingMemo.noteAtStart.w+a,d=this.draggingMemo.noteAtStart.y+s,g=this.draggingMemo.noteAtStart.h+h,l<p&&(n&&(r=this.draggingMemo.noteAtStart.w+this.draggingMemo.noteAtStart.x-p),l=p),l+r>u&&(l=u-r),r<0&&(r=0,l=this.draggingMemo.noteAtStart.w+this.draggingMemo.noteAtStart.x),t.x=r,t.w=l,g<p&&(s&&(d=this.draggingMemo.noteAtStart.h+this.draggingMemo.noteAtStart.y-p),g=p),g+d>c&&(g=c-d),d<0&&(d=0,g=this.draggingMemo.noteAtStart.h+this.draggingMemo.noteAtStart.y),t.y=d,t.h=g}else"move"===this.draggingMemo.type&&(r=this.draggingMemo.noteAtStart.x-o/this.ratio,d=this.draggingMemo.noteAtStart.y-i/this.ratio,r<0&&(r=0),r+this.draggingMemo.noteAtStart.w>u&&(r=u-this.draggingMemo.noteAtStart.w),d<0&&(d=0),d+this.draggingMemo.noteAtStart.h>c&&(d=c-this.draggingMemo.noteAtStart.h),t.x=r,t.y=d);this.positionNote(t)},handleDraggingMouseUp:function(e){this.enterState("editing",{note:this.draggingMemo.note,element:this.draggingMemo.element})},storeNoteBackup:function(t){this.noteBeforeEdits||(this.noteBeforeEdits=e.clone(t))},getNoteBackup:function(){return this.noteBeforeEdits},deleteNoteBackup:function(){delete this.noteBeforeEdits},getNoteByID:function(e){return this.notes.find?this.notes.find(function(t){return t.yuid===e}):this.notes.filter(function(t){return t.yuid===e})[0]},renderNotes:function(){var t,o,i=this.getNoteBackup();i&&(t=e.clone(i.node.getDOMNode())),this.box.all(".note").remove(!0),this.notes.forEach(this.createNewNote.bind(this)),i&&((o=this.box.one("[data-note-yuid="+i.yuid+"]")).set("className",t.className),i.node=o)},createNewNote:function(t){t.node=e.Node.create('<span class="note" data-note-yuid="'+t.yuid+'"></span>'),t.canEdit&&t.node.addClass("note-can-edit"),this.box.append(t.node),this.positionNote(t)},positionNote:function(e){var t,o=e.getScaled(this.ratio);e.node.setStyles({left:o.x+"px",top:o.y+"px",width:o.w+"px",height:o.h+"px",zIndex:e.z}),(t=this.box.one(".note-text[data-for-note-yuid="+e.yuid+"]"))&&(t.setStyle("z-index",i),t.one(".text-alignment-fix").setStyles({left:o.x+"px",top:o.y+o.h+2+"px"}))},restackNotes:function(){this.notes.sort(function(e,t){return t.w*t.h-e.w*e.h}).forEach(function(e){e.z=i++})},syncWithPhoto:function(){var t=e.one(".photo-well-media-scrappy-view").getDOMNode(),o=parseInt(getComputedStyle(t).paddingTop,10),i=parseInt(getComputedStyle(t).paddingBottom,10),n=t.offsetWidth,s=t.offsetHeight-o-i,a=t.offsetLeft,h=t.offsetTop+o;this.box.setStyles({width:n+"px",height:s+"px",left:a+"px",top:h+"px"}),this.ratio=Math.max(n,s)/500,this.boxWidth=n,this.boxHeight=s,this.boxLeft=a,this.boxTop=h},hideHovered:function(){this.box.all(".note-hovered").removeClass("note-hovered"),this.box.all(".note-text:not(.adding)").remove(!0)},deactivate:function(){this.get("container").setStyle("display","none").remove()}})},"@VERSION@",{requires:["hermes-template-photo-note-read-mode","hermes-template-photo-note-write-mode","hermes-template-photo-note-drag-handles","flickr-view"],optional:["photo-notes-models","photo-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-account-menu",function(a,n){var e=a.Template.Handlebars.revive({1:function(a,n,e,t,l){var s,r=null!=n?n:{},u=e.helperMissing,i=a.escapeExpression;return'\t<div class="c-account-menu">\n\t\t<div class="c-account-buddyicon">\n\t\t\t<a href="/account"\n\t\t\t\ttabindex="0"\n\t\t\t\taria-haspopup="true"\n\t\t\t\taria-expanded="false"\n\t\t\t\taria-label="'+i((e.intlMessage||n&&n.intlMessage||u).call(r,{name:"intlMessage",hash:{intlName:"autosuggest.YOUR_ACCOUNT"},data:l}))+'">\n\t\t\t\t<div class="avatar person tiny" style="background-image: url('+i(a.lambda(null!=(s=null!=(s=null!=n?n.user:n)?s.buddyicon:s)?s.default:s,n))+')"></div>\n\t\t\t</a>\n\n\t\t\t'+(null!=(s=(e.isNotFlipped||n&&n.isNotFlipped||u).call(r,"notifications-menu",{name:"isNotFlipped",hash:{},fn:a.program(2,l,0),inverse:a.noop,data:l}))?s:"")+"\n\t\t</div>\n\t</div>\n"},2:function(a,n,e,t,l){var s;return null!=(s=e.if.call(null!=n?n:{},null!=(s=null!=n?n.user:n)?s.unreadMessages:s,{name:"if",hash:{},fn:a.program(3,l,0),inverse:a.noop,data:l}))?s:""},3:function(a,n,e,t,l){var s;return'<span class="c-account-unreadcount">'+a.escapeExpression(a.lambda(null!=(s=null!=n?n.user:n)?s.unreadMessages:s,n))+"</span>"},compiler:[7,">= 4.0.0"],main:function(a,n,e,t,l){var s;return null!=(s=e.if.call(null!=n?n:{},null!=(s=null!=n?n.user:n)?s.signedIn:s,{name:"if",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l}))?s:""},useData:!0}),t={};a.Array.each([],function(n){var e=a.Template.get("hermes/"+n);e&&(t[n]=e)}),a.Template.register("hermes/account-menu",function(n,l){return l=l||{},l.partials=l.partials?a.merge(t,l.partials):t,e(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-greetings",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,l,s){var t,u=a.lambda,i=a.escapeExpression,m=null!=e?e:{},h=n.helperMissing;return"<h4>Hola, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SPANISH"},data:s}))+"</p>\n<h4>Guten Tag, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GERMAN"},data:s}))+"</p>\n<h4>Servus, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GERMAN"},data:s}))+"</p>\n<h4>G&rsquo;day, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_AUSTRALIAN"},data:s}))+"</p>\n<h4>Hoi, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_DUTCH"},data:s}))+"</p>\n<h4>Yo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Hi, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Oi, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Hala, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ARABIC"},data:s}))+"</p>\n<h4>Ahoy, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Hello, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Bonjour, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FRENCH"},data:s}))+"</p>\n<h4>Salut, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FRENCH"},data:s}))+"</p>\n<h4>Salaam, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ARABIC"},data:s}))+"</p>\n<h4>Ciao, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ITALIAN"},data:s}))+"</p>\n<h4>Hola, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SPANISH"},data:s}))+"</p>\n<h4>Hej, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SWEDISH"},data:s}))+"</p>\n<h4>Aloha, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HAWAIIAN"},data:s}))+"</p>\n<h4>Kumusta, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TAGALOG"},data:s}))+"</p>\n<h4>Shalom, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HEBREW"},data:s}))+"</p>\n<h4>'Allo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ENGLISH"},data:s}))+"</p>\n<h4>Namaste, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HINDI"},data:s}))+"</p>\n<h4>Ni hao, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_MANDARIN"},data:s}))+"</p>\n<h4>Ol&aacute;, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_PORTUGUESE"},data:s}))+"</p>\n<h4>P&euml;rsh&euml;ndetje, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ALBANIAN"},data:s}))+"</p>\n<h4>Tere, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ESTONIAN"},data:s}))+"</p>\n<h4>Yasou, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_GREEK"},data:s}))+"</p>\n<h4>Szia, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HUNGARIAN"},data:s}))+"</p>\n<h4>Mbote, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LINGALA"},data:s}))+"</p>\n<h4>Jambo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SWAHILI"},data:s}))+"</p>\n<h4>Moyo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TSHILUBA"},data:s}))+"</p>\n<h4>Merhaba, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_TURKISH"},data:s}))+"</p>\n<h4>Mingalaba, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BURMESE"},data:s}))+"</p>\n<h4>G&#243;&#240;an daginn, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ICELANDIC"},data:s}))+"</p>\n<h4>Sawubona, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ZULU"},data:s}))+"</p>\n<h4>Bangawoyo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KOREAN"},data:s}))+"</p>\n<h4>F&aacute;ilte, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_IRISH"},data:s}))+"</p>\n<h4>Labdien, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LATVIAN"},data:s}))+"</p>\n<h4>Kaixo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BASQUE"},data:s}))+"</p>\n<h4>Nomoshkar, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BENGALI"},data:s}))+"</p>\n<h4>Zdrasti, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_BULGARIAN"},data:s}))+"</p>\n<h4>Bok, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_CROATIAN"},data:s}))+"</p>\n<h4>Dobr&yacute; den, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_CZECH"},data:s}))+"</p>\n<h4>Hej, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_DANISH"},data:s}))+"</p>\n<h4>Hyv&auml;&auml; p&auml;iv&auml;&auml;, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_FINNISH"},data:s}))+"</p>\n<h4>Mike, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HOPI"},data:s}))+"</p>\n<h4>Szia, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_HUNGARIAN"},data:s}))+"</p>\n<h4>Halo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_INDONESIAN"},data:s}))+"</p>\n<h4>Namaskara, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KANNADA"},data:s}))+"</p>\n<h4>Chonî, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_KURDISH"},data:s}))+"</p>\n<h4>Labas, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_LITHUANIAN"},data:s}))+"</p>\n<h4>Selamat datang, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_MALAYSIAN"},data:s}))+"</p>\n<h4>Hei, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_NORWEGIAN"},data:s}))+"</p>\n<h4>Witaj, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_POLISH"},data:s}))+"</p>\n<h4>Bun&#x103; Ziua, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ROMANIAN"},data:s}))+"</p>\n<h4>Privet, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_RUSSIAN"},data:s}))+"</p>\n<h4>Zdravo, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SERBIAN"},data:s}))+"</p>\n<h4>Ahoj, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_SLOVAKIAN"},data:s}))+"</p>\n<h4>Pryvit, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_UKRAINIAN"},data:s}))+"</p>\n<h4>Xin ch&agrave;o, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_VIETNAMESE"},data:s}))+"</p>\n<h4>Sawubona, "+i(u(null!=(t=null!=(t=null!=e?e.attrs:e)?t.user:t)?t.username:t,e))+"!</h4><p>"+i((n.intlMessage||e&&e.intlMessage||h).call(m,{name:"intlMessage",hash:{intlName:"account-menu.GREETING_CAPTION_ZULU"},data:s}))+"</p> \n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,l,s){var t,u,i;return u=null!=(u=n.randomLine||(null!=e?e.randomLine:e))?u:n.helperMissing,i={name:"randomLine",hash:{},fn:a.program(1,s,0),inverse:a.noop,data:s},t="function"==typeof u?u.call(null!=e?e:{},i):u,n.randomLine||(t=n.blockHelperMissing.call(e,t,i)),null!=t?t:""},useData:!0}),l={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(l[e]=n)}),a.Template.register("hermes/greetings",function(e,s){return s=s||{},s.partials=s.partials?a.merge(l,s.partials):l,n(e,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-account-menu-dialog-styleguide",function(a,n){var t=a.Template.Handlebars.revive({1:function(a,n,t,l,e){var s;return'\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{used:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageUsedFormatted:s,intlName:"account-menu.SPACE_USED_UNLIMITED"},data:e}))+"</span>\n"},3:function(a,n,t,l,e){var s,r=null!=n?n:{},u=a.escapeExpression;return(null!=(s=t.if.call(r,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.photoCount:s,{name:"if",hash:{},fn:a.program(4,e,0),inverse:a.program(12,e,0),data:e}))?s:"")+'\t\t\t<span class="storage-count secondary">'+u((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(r,{name:"intlHTMLMessage",hash:{total:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageTotalFormatted:s,percentage:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageUsedPercentage:s,intlName:"account-menu.SPACE_USED_STYLEGUIDE"},data:e}))+'</span></div>\n\t\t\t<div class="bar" style="box-shadow: 0 0 0 1px #898989, inset '+u(a.lambda(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.barWidth:s,n))+'px 0 #008ddf;">\n'},4:function(a,n,t,l,e){var s;return null!=(s=t.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.pluralPhotos:s,{name:"if",hash:{},fn:a.program(5,e,0),inverse:a.program(10,e,0),data:e}))?s:""},5:function(a,n,t,l,e){var s;return null!=(s=t.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.oneK:s,{name:"if",hash:{},fn:a.program(6,e,0),inverse:a.program(8,e,0),data:e}))?s:""},6:function(a,n,t,l,e){var s;return'\t\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{num:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.photoCount:s,intlName:"account-menu.PHOTO_COUNT_1K"},data:e}))+"</span>\n"},8:function(a,n,t,l,e){var s;return'\t\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{num:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.photoCount:s,intlName:"account-menu.PHOTO_COUNT_MANY"},data:e}))+"</span>\n"},10:function(a,n,t,l,e){return'\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{intlName:"account-menu.PHOTO_COUNT_ONE"},data:e}))+"</span>\n"},12:function(a,n,t,l,e){return'\t\t\t\t<span class="photo-count secondary">'+a.escapeExpression((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{intlName:"account-menu.PHOTO_COUNT_NONE"},data:e}))+"</span>\n"},14:function(a,n,t,l,e){var s;return null!=(s=t.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.canBuyPro:s,{name:"if",hash:{},fn:a.program(15,e,0),inverse:a.program(17,e,0),data:e}))?s:""},15:function(a,n,t,l,e){return'\t\t\t\t<div class="upgrade">\n\t\t\t\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((t.intlMessage||n&&n.intlMessage||t.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.GOPRO"},data:e}))+"</a>\n\t\t\t\t</div>\n"},17:function(a,n,t,l,e){var s;return"\n"+(null!=(s=(t.isNotFlipped||n&&n.isNotFlipped||t.helperMissing).call(null!=n?n:{},"enable-new-pro",{name:"isNotFlipped",hash:{},fn:a.program(18,e,0),inverse:a.noop,data:e}))?s:"")+"\n"},18:function(a,n,t,l,e){return'\n\t\t\t\t\t<div class="upgrade">\n\t\t\t\t\t\t<a href="/account/upgrade/adfree" data-action="follow" class="small butt">'+a.escapeExpression((t.intlMessage||n&&n.intlMessage||t.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.GOADFREE"},data:e}))+"</a>\n\t\t\t\t\t</div>\n\n"},20:function(a,n,t,l,e){var s;return"<span >&nbsp;("+a.escapeExpression(a.lambda(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.unreadMessages:s,n))+")</span>"},compiler:[7,">= 4.0.0"],main:function(a,n,t,l,e){var s,r=a.lambda,u=a.escapeExpression,i=null!=n?n:{},o=t.helperMissing;return'<div class="fluid">\n\t<div class="top-half dark" style="background-image: url('+u(r(null!=(s=null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.coverPhotoUrls:s)?s.t:s,n))+')">\n\t\t<a href="/photos/me"><span class="avatar person medium" style="background-image: url('+u(r(null!=(s=null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.buddyicon:s)?s.default:s,n))+')"></span></a>\n'+(null!=(s=a.invokePartial(l.greetings,n,{name:"greetings",data:e,indent:"\t\t",helpers:t,partials:l,decorators:a.decorators}))?s:"")+'\t</div>\n\t<div class="bottom-half light">\n\t\t<div class="labels">\n'+(null!=(s=t.if.call(i,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.isPro:s,{name:"if",hash:{},fn:a.program(1,e,0),inverse:a.program(3,e,0),data:e}))?s:"")+"\t\t</div>\n\n"+(null!=(s=t.unless.call(i,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.isNoAds:s,{name:"unless",hash:{},fn:a.program(14,e,0),inverse:a.noop,data:e}))?s:"")+'\n\n\t\t<div class="links secondary">\n\t\t\t<span class="link-wrapper">\n\t\t\t\t<ul>\n\t\t\t\t\t<li><a href="/mail"  data-action="follow">'+u((t.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:e}))+(null!=(s=t.if.call(i,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.unreadMessages:s,{name:"if",hash:{},fn:a.program(20,e,0),inverse:a.noop,data:e}))?s:"")+'</a></li>\n\t\t\t\t\t<li><a href="//help.flickr.com/"  data-action="follow">'+u((t.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.HELP"},data:e}))+'</a></li>\n\t\t\t\t\t<li><a href="/account"  data-action="follow">'+u((t.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:e}))+'</a></li>\n\t\t\t\t\t<li><a href="/logout.gne?csrf='+u(r(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.csrf:s,n))+'"  data-action="follow">'+u((t.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.SIGN_OUT"},data:e}))+"</a></li>\n\t\t\t\t</ul>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),l={};a.Array.each(["greetings"],function(n){var t=a.Template.get("hermes/"+n);t&&(l[n]=t)}),a.Template.register("hermes/account-menu-dialog-styleguide",function(n,e){return e=e||{},e.partials=e.partials?a.merge(l,e.partials):l,t(n,e)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-greetings"]});YUI.add("hermes-template-account-menu-card",function(a,n){var t=a.Template.Handlebars.revive({1:function(a,n,t,e,l){var s;return null!=(s=t.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.isPro:s,{name:"if",hash:{},fn:a.program(2,l,0),inverse:a.program(4,l,0),data:l}))?s:""},2:function(a,n,t,e,l){var s;return'\t\t\t\t\t<span class="storage-count tertiary">'+a.escapeExpression((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{used:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageUsedFormatted:s,intlName:"account-menu.SPACE_USED_UNLIMITED"},data:l}))+"</span>\n"},4:function(a,n,t,e,l){var s,r=a.escapeExpression;return'\t\t\t\t\t<div class="bar" style="box-shadow: 0 0 0 1px transparent, inset '+r(a.lambda(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.barWidth:s,n))+'px 0 #008ddf;">\n\t\t\t\t\t\t<span class="storage-count tertiary">'+r((t.intlHTMLMessage||n&&n.intlHTMLMessage||t.helperMissing).call(null!=n?n:{},{name:"intlHTMLMessage",hash:{total:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageTotalFormatted:s,percentage:null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.storageUsedPercentage:s,intlName:"account-menu.SPACE_USED"},data:l}))+"</span>\n\t\t\t\t\t</div>\n"},6:function(a,n,t,e,l){var s;return null!=(s=t.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.hasUnlimitedStorage:s,{name:"if",hash:{},fn:a.program(2,l,0),inverse:a.program(4,l,0),data:l}))?s:""},8:function(a,n,t,e,l){return'\t\t\t\t<div class="upgrade" style="display: none;">\n\t\t\t\t\t<a href="/account/upgrade/pro" data-track="accountMenuCardProClick" class="small butt"><div class="balls"></div></a>\n\t\t\t\t</div>\n'},10:function(a,n,t,e,l){var s;return"\n"+(null!=(s=(t.isNotFlipped||n&&n.isNotFlipped||t.helperMissing).call(null!=n?n:{},"enable-new-pro",{name:"isNotFlipped",hash:{},fn:a.program(11,l,0),inverse:a.noop,data:l}))?s:"")+"\n"},11:function(a,n,t,e,l){var s;return null!=(s=t.if.call(null!=n?n:{},null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.canBuyPro:s,{name:"if",hash:{},fn:a.program(12,l,0),inverse:a.program(14,l,0),data:l}))?s:""},12:function(a,n,t,e,l){return'\t\t\t\t\t<div class="upgrade">\n\t\t\t\t\t\t<a href="/account/upgrade/pro" data-track="accountMenuCardProClick" class="small butt">'+a.escapeExpression((t.intlMessage||n&&n.intlMessage||t.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.GOPRO"},data:l}))+"</a>\n\t\t\t\t\t</div>\n"},14:function(a,n,t,e,l){var s;return"\n"+(null!=(s=(t.isNotFlipped||n&&n.isNotFlipped||t.helperMissing).call(null!=n?n:{},"enable-new-pro",{name:"isNotFlipped",hash:{},fn:a.program(15,l,0),inverse:a.noop,data:l}))?s:"")+"\n"},15:function(a,n,t,e,l){return'\n\t\t\t\t\t\t<div class="upgrade">\n\t\t\t\t\t\t\t<a href="/account/upgrade/adfree" data-track="accountMenuCardProClick" class="small butt">'+a.escapeExpression((t.intlMessage||n&&n.intlMessage||t.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"account-menu.GOADFREE"},data:l}))+"</a>\n\t\t\t\t\t\t</div>\n\n"},17:function(a,n,t,e,l){return" with-notifs"},19:function(a,n,t,e,l){var s,r=null!=n?n:{};return'<li><a href="/mail"  data-track="accountMenuMailClick">'+a.escapeExpression((t.intlMessage||n&&n.intlMessage||t.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"common.FLICKRMAIL"},data:l}))+(null!=(s=t.if.call(r,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.unreadMessages:s,{name:"if",hash:{},fn:a.program(20,l,0),inverse:a.noop,data:l}))?s:"")+"</a></li>"},20:function(a,n,t,e,l){var s;return"<span >&nbsp;("+a.escapeExpression(a.lambda(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.unreadMessages:s,n))+")</span>"},compiler:[7,">= 4.0.0"],main:function(a,n,t,e,l){var s,r=null!=n?n:{},i=t.helperMissing,u=a.escapeExpression;return'<div class="fluid account-menu-card">\n\t<div class="title">\n'+(null!=(s=a.invokePartial(e.greetings,n,{name:"greetings",data:l,indent:"\t\t",helpers:t,partials:e,decorators:a.decorators}))?s:"")+'\t</div>\n\t<div class="info">\n\t\t<div class="labels">\n\n'+(null!=(s=(t.isNotFlipped||n&&n.isNotFlipped||i).call(r,"enable-new-pro",{name:"isNotFlipped",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l}))?s:"")+(null!=(s=(t.isFlipped||n&&n.isFlipped||i).call(r,"enable-new-pro",{name:"isFlipped",hash:{},fn:a.program(6,l,0),inverse:a.noop,data:l}))?s:"")+"\n\t\t</div>\n\n"+(null!=(s=(t.isFlipped||n&&n.isFlipped||i).call(r,"enable-new-pro",{name:"isFlipped",hash:{},fn:a.program(8,l,0),inverse:a.noop,data:l}))?s:"")+"\n"+(null!=(s=t.unless.call(r,null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.isNoAds:s,{name:"unless",hash:{},fn:a.program(10,l,0),inverse:a.noop,data:l}))?s:"")+'\n\n\t\t<div class="links secondary">\n\t\t\t<span class="link-wrapper'+(null!=(s=(t.isFlipped||n&&n.isFlipped||i).call(r,"notifications-menu",{name:"isFlipped",hash:{},fn:a.program(17,l,0),inverse:a.noop,data:l}))?s:"")+'">\n\t\t\t\t<ul>\n\t\t\t\t\t'+(null!=(s=(t.isNotFlipped||n&&n.isNotFlipped||i).call(r,"notifications-menu",{name:"isNotFlipped",hash:{},fn:a.program(19,l,0),inverse:a.noop,data:l}))?s:"")+'\n\n\t\t\t\t\t<li><a href="//help.flickr.com/"  data-track="accountMenuHelpClick">'+u((t.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.HELP"},data:l}))+'</a></li>\n\n\t\t\t\t\t<li><a href="/account" data-track="accountMenuWalletClick">'+u((t.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.SETTINGS"},data:l}))+'</a></li>\n\n\t\t\t\t\t<li><a href="/logout.gne?csrf='+u(a.lambda(null!=(s=null!=(s=null!=n?n.attrs:n)?s.user:s)?s.csrf:s,n))+'"  data-track="accountMenuSignoutClick">'+u((t.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.SIGN_OUT"},data:l}))+"</a></li>\n\t\t\t\t</ul>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),e={};a.Array.each(["greetings"],function(n){var t=a.Template.get("hermes/"+n);t&&(e[n]=t)}),a.Template.register("hermes/account-menu-card",function(n,l){return l=l||{},l.partials=l.partials?a.merge(e,l.partials):e,t(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-greetings"]});YUI.add("hermes-template-account-menu-card-get-pro-button",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,t,l){return'\t<div class="upgrade">\n\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"account-menu.GETPRO"},data:l}))+"</a>\n\t</div>\n"},3:function(a,e,n,t,l){return'\t<div class="upgrade">\n\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"account-menu.RESUBSCRIBE_TO_PRO"},data:l}))+"</a>\n\t</div>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,t,l){var s,r=null!=e?e:{};return(null!=(s=n.if.call(r,null!=e?e.canPurchase:e,{name:"if",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l}))?s:"")+(null!=(s=n.if.call(r,null!=e?e.canResubscribe:e,{name:"if",hash:{},fn:a.program(3,l,0),inverse:a.noop,data:l}))?s:"")},useData:!0}),t={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(t[e]=n)}),a.Template.register("hermes/account-menu-card-get-pro-button",function(e,l){return l=l||{},l.partials=l.partials?a.merge(t,l.partials):t,n(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("products-api-helper",function(e,o){e.ProductsAPIHelper={parseOrder:function(e,o){var t,r,i,s,d;if(d={},t=o.orderRegistry,e.orderId&&(e.id=e.orderId),e.couponMetadata&&!e.couponMetadata.isValidCoupon)throw s=new Error(e.couponMetadata.invalidReason),s.name="CouponInvalidError",s;return e.coupons&&(d.coupon=this.parseCoupons(e.coupons.coupon,e.couponMetadata,e.orderId,o),(i=d.coupon.getValue("discounts").getList()[0])&&"percent"===i.getValue("discountType")&&100===parseInt(i.getValue("discountValue"),10)?d.isFreeOrder=1:d.isFreeOrder=0),e.item&&(d.items=this.parseItems(e.item,e.id,o)),d.orderId=e.orderId,d.statusOrder=e.statusOrder,d.statusPrint=e.statusPrint,d.statusPayment=e.statusPayment,d.paymentMethodId=e.paymentMethodId,d.bookPreviewPdf=e.bookPreviewPdf,d.userId=e.userId,d.trackingNum=e.trackingNum,d.trackingUrl=e.trackingUrl,d.costTotal=parseFloat(e.costTotal)||0,d.costProducts=parseFloat(e.costProducts)||0,d.costShipping=e.costShipping||0,d.costDiscount=e.costDiscount||0,d.costTax=e.costTax,d.isCouponApplied=e.isCouponApplied,d.shippingType=e.shippingType||e.shipMethod||"standard_shipping",d.dateCreate=e.dateCreate,e.countryCode&&(d.countryCode=e.countryCode),t.exists(e.orderId)?((r=t.proxy(e.orderId)).setValues(d),r):(d.id=e.orderId,t.add(d))},parseCoupons:function(e,o,t,r){var i,s,d,p,a,n,c,u,g,l;if(o&&!o.isValidCoupon)throw g=new Error(o.invalidReason),g.name="CouponInvalidError",g;return i=r.couponRegistry,s=r.discountRegistry,a=[],e.id=e.couponId,n=e.discounts.discount[0],l=n.discountId,u={costDiscount:n.costDiscount,couponId:e.id,discountType:n.discountType,discountValue:n.discountValue,minPurchaseValue:n.minPurchaseValue,productEntity:n.productEntity},s.exists(l)?(s.setValues(l,u),c=s.proxy(l)):(u.id=l,c=s.add(u)),a.push(c),d={code:e.code,orderId:t,discounts:a},o&&(d.isSingleUse=o.isSingleUse,d.isUserSpecific=o.isUserSpecific,d.isValidCoupon=o.isValidCoupon),i.exists(e.id)?(i.setValues(e.id,d),p=i.proxy(e.id)):(d.id=e.id,p=i.add(d)),p},parseItems:function(e,o,t){var r,i,s;return r=t.orderItemRegistry,i=t.itemPriceRegistry,e instanceof Array&&(e=e[0]),e=e.map(function(e){var t,d,p,a,n=e.renderedProductId,c={};return c.sourceProductId=e.sourceProductId,c.productType=e.productType,c.productTitle=e.productTitle,c.quantity=e.quantity,c.cost=e.costProductUnit,c.orderId=o,e.productPrice&&(p=e.productPrice,s={priceBase:p.priceBase,countPagesBase:p.countPagesBase,countPagesExtra:p.countPagesExtra,pricePerPage:p.pricePerPage,pricePagesExtra:p.pricePagesExtra,priceTotal:p.priceTotal},p.shipping&&((a=p.shipping).standardShipping&&(s.standardShippingBase=a.standardShipping.priceShippingBase,s.standardShippingExtra=a.standardShipping.priceShippingExtra),a.expressShipping&&(s.expressShippingBase=a.expressShipping.priceShippingBase,s.expressShippingExtra=a.expressShipping.priceShippingExtra)),i.exists(n)?(t=i.proxy(n)).setValues(s):(s.id=n,t=i.add(s))),e.product&&e.product.skuId&&(c.skuId=e.product.skuId),c.price=t,r.exists(n)?((d=r.proxy(n)).setValues(c),d):(c.id=n,r.add(c))})},parseBook:function(o,t){var r,i=o,s=t.pageModelRegistry,d=t.bookModelRegistry,p=t.pagePhotoModelRegistry,a=t.photoModelRegistry,n=t.personRegistry,c=t.photoEngagementRegistry,u=t.photoStatsRegistry,g=[];if(i)return o={id:i.id,owner:i.owner,title:i.title,coverPhotoId:i.coverPageId,totalPhotos:0,price:i.price,created:i.dateCreate},i.page&&e.Array(i.page).forEach(function(t){var i,d=[];t.photo&&e.Array(t.photo).forEach(function(i){var s,g;e.Lang.isNumber(parseInt(i.id,10))&&(t.id=String(t.id).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),s={id:t.id+"_"+i.position,bookId:o.id,position:i.position,cropX:i.cropX/100,cropY:i.cropY/100,cropW:i.cropW/100,cropH:i.cropH/100,invalidForPrintReason:i.invalidForPrintReason,isInvalidForPrint:i.isInvalidForPrint},g=e.APIHelper.response.parsePhotos({photos:[i],personModelRegistry:n,photoModelRegistry:a,photoEngagementModelRegistry:c,photoStatsModelRegistry:u})[0],s.photo=g,r=s.id,p.exists(r)?(delete s.id,p.setValues(r,s)):p.add(s),d.push(p.proxy(r)))}),(i=e.APIHelper.response.parsePage(t)).bookId=o.id,i.pagePhotos=d,r=i.id,s.exists(r)?(delete i.id,s.setValues(r,i),t=s.proxy(r)):t=s.add(i),g.push(r),o.totalPhotos=o.totalPhotos+d.length,o.coverPage||(o.coverPage=t)}),o.pageOrder=g,d.exists(o.id)?d.setValues(o.id,{title:o.title,pageOrder:o.pageOrder,totalPhotos:o.totalPhotos,coverPage:o.coverPage}):d.add(o),o},parseSubscriptionCoupon:function(e,o){var t,r,i,s,d,p,a,n;return t=o.couponRegistry,r=o.discountRegistry,d=e.discount,e.id=d.couponCode,n=d.discountId,a={costDiscount:d.costDiscount,couponId:e.id,discountType:d.discountType,discountValue:d.discountValue,minPurchaseValue:d.minPurchaseValue,productEntity:d.productEntity},r.exists(n)?(r.setValues(n,a),p=r.proxy(n)):(a.id=n,p=r.add(a)),i={code:d.couponCode,subscriptionId:e.subscriptionId,discounts:[p],isValidCoupon:"ok"===e.stat},t.exists(e.id)?(t.setValues(e.id,i),s=t.proxy(e.id)):(i.id=e.id,s=t.add(i)),s}}},"@VERSION@",{requires:[]});YUI.add("flickr-products-discounts-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.Promise.resolve()},create:function(t){return e.Promise.resolve()},delete:function(t){return e.Promise.resolve()}},attributes:{costDiscount:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},couponId:{},discountType:{},discountValue:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},minPurchaseValue:{setter:function(e){return e?parseFloat(e).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(e){return parseFloat(0).toFixed(2)}},productEntity:{}}})},"@VERSION@",{requires:["flickr-model-registry"]});YUI.add("flickr-products-order-items-setQuantity-updater",function(r,t){"use strict";r.namespace("ModelUpdaters")["flickr-products-order-items-setQuantity-updater"]={run:function(e,i){return i.callAPI("flickr.products.orders.setItemQuantity",e).then(function(r){},r.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("products-order-item-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{update:function(e,r){var i;return"quantity"in r?(i={order_id:this.getValue(e,"orderId"),product_id:e,quantity:r.quantity.newVal},t.ModelUpdaters["flickr-products-order-items-setQuantity-updater"].run(i,this.appContext)):t.Promise.resolve()}},attributes:{orderId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},sourceProductId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},productType:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},productTitle:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},quantity:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},cost:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},skuId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},price:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-products-order-items-setQuantity-updater"]});YUI.add("products-order-item-price-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,attributes:{orderItemId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},priceBase:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},countPagesBase:{getter:function(t){return parseInt(t,10)},validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},countPagesExtra:{getter:function(t){return parseInt(t,10)},validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},pricePerPage:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},pricePagesExtra:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},priceTotal:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},standardShippingBase:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},standardShippingExtra:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},expressShippingBase:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}},expressShippingExtra:{setter:function(t){return t?parseFloat(t).toFixed(2):parseFloat(0).toFixed(2)},defaultFn:function(t){return parseFloat(0).toFixed(2)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-products-order-items-setQuantity-updater"]});YUI.add("flickr-products-orders-removeCoupon-deletor",function(r,e){"use strict";r.namespace("ModelDeletors")["flickr-products-orders-removeCoupon"]={run:function(o,s){return new r.FlickrPromise({response:s.callAPI("flickr.products.orders.removeCoupon",this._processParams(o)),orderRegistry:s.getModelRegistry("flickr-products-orders-models"),couponRegistry:s.getModelRegistry("flickr-products-coupons-models"),discountRegistry:s.getModelRegistry("flickr-products-discounts-models"),itemRegistry:s.getModelRegistry("products-order-item-models"),itemPriceRegistry:s.getModelRegistry("products-order-item-price-models")}).then(this._processResponse,r.FetcherErrorLogger(e))},_processParams:function(r){var e={};return e.order_id=r.orderId,e.coupon_code=r.couponCode,e},_processResponse:function(e){var o,s,t,d,i,c,p;return p=e.response,o=e.orderRegistry,s=e.couponRegistry,t=e.discountRegistry,d=e.itemRegistry,i=e.itemPriceRegistry,c={orderRegistry:o,orderItemRegistry:d,itemPriceRegistry:i,couponRegistry:s,discountRegistry:t},o.remove(p.order.orderId),r.ProductsAPIHelper.parseOrder(p.order,c)}}},"@VERSION@",{requires:["flickr-promise","products-api-helper"],optional:["flickr-products-orders-models","flickr-products-coupons-models","flickr-products-discounts-models","products-order-item-models","products-order-item-price-models"]});YUI.add("flickr-products-coupons-models",function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.Promise.resolve()},create:function(r){return e.ModelCreators["flickr-products-orders-applyCoupon"].run(r,this.appContext)},delete:function(r,o){return o={couponCode:this.getValue(r,"code"),orderId:this.getValue(r,"orderId")},e.ModelDeletors["flickr-products-orders-removeCoupon"].run(o,this.appContext)}},attributes:{code:{},orderId:{},discounts:{isListProxy:!0},isValidCoupon:{},isUserSpecific:{},isSingleUse:{},invalidReason:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-products-orders-applyCoupon-creator","flickr-products-orders-removeCoupon-deletor"]});YUI.add("flickr-products-orders-create-creator",function(r,e){"use strict";r.namespace("ModelCreators")["flickr-products-orders-create"]={run:function(s,o){var t=this;return new r.FlickrPromise({response:o.callAPI("flickr.products.orders.create",this._processParams(s)),orderRegistry:o.getModelRegistry("flickr-products-orders-models"),couponRegistry:o.getModelRegistry("flickr-products-coupons-models"),discountRegistry:o.getModelRegistry("flickr-products-discounts-models"),itemRegistry:o.getModelRegistry("products-order-item-models"),itemPriceRegistry:o.getModelRegistry("products-order-item-price-models")}).then(function(r){return t._processResponse(r,s,o)},r.FetcherErrorLogger(e))},_processParams:function(r){var e={};return r=r||{},e.items=r.bookId||r.items,e.cacheBust=Date.now(),e},_processResponse:function(e,s,o){var t,i,c,d,u,n,p;return p=e.response,t=e.orderRegistry,i=e.couponRegistry,c=e.discountRegistry,d=e.itemRegistry,u=e.itemPriceRegistry,n={orderRegistry:t,orderItemRegistry:d,itemPriceRegistry:u,couponRegistry:i,discountRegistry:c},r.ProductsAPIHelper.parseOrder(p.order,n)}}},"@VERSION@",{requires:["flickr-promise","flickr-products-orders-models","flickr-products-coupons-models","flickr-products-discounts-models","products-order-item-models","products-order-item-price-models"],optional:[]});